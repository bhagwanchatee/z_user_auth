sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Button","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/format/DateFormat","sap/m/library","sap/ui/core/library","com/scp/fiori/outwardgateentry/model/formatter"],(e,t,r,a,n,o,s,l,i)=>{"use strict";let T=l.ValueState;let u=s.ButtonType;return e.extend("com.scp.fiori.outwardgateentry.controller.View1",{formatter:i,onInit(){let e=this;this.vehicleTypes=[];this.aTransporterList=[];this.aBillingDocList=[];this.aUniqueBillingDocList=[];this.aMaterialData=[];this.aUniqueMaterial=[];this.oParameters={$top:2e4};let t=new Date;let r=o.getInstance({pattern:"MMM dd, yyyy"});let a=r.format(t);this.byId("idDate").setValue(a);let n=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`;this.byId("idTime").setValue(n);this.ZB_OUT_GATE_Model=this.getOwnerComponent().getModel();setTimeout(function(){e.getPlantData();e.getVehicleTypes();e.getTransporter()},400);let s=new sap.ui.model.json.JSONModel([]);this.getView().byId("idTable_OutwardItem").setModel(s);this.onAddOutwardItem()},onSelectPlant:function(e){let t=e.getSource(),r=t.getSelectedKey(),a=t.getValue();if(!r&&a){t.setValueState(T.Error);t.setValueStateText("Invalid Value")}else{t.setValueState(T.None);this.getBillingDocList(r)}},onSelectVehicalType:function(e){let t=e.getSource(),r=t.getSelectedKey(),a=t.getValue();if(!r&&a){t.setValueState(T.Error);t.setValueStateText("Invalid Value")}else{t.setValueState(T.None)}},getPlantData:function(){let e=this;let t=new sap.ui.model.json.JSONModel;this.ZB_OUT_GATE_Model.read("/PlantF4Help",{urlParameters:this.oParameters,success:function(r){t.setData(r.results);e.getView().byId("idDropdownPlant").setModel(t)},error:function(e){a.error("Failed to load plant list")}})},getVehicleTypes:function(){this.vehicleTypes=[{VehicleType:"1109 TRUCK"},{VehicleType:"1612 TRUCK"},{VehicleType:"407 TEMPO"},{VehicleType:"709 TRUCK"},{VehicleType:"909 TRUCK"},{VehicleType:"AUTO RICKSHAW"},{VehicleType:"CONTAINER 14 FT"},{VehicleType:"CONTAINER 20 FT"},{VehicleType:"CONTAINER 30 FT"},{VehicleType:"CONTAINER 40 FT"},{VehicleType:"LOADING RICKSHAW 3W"},{VehicleType:"LOADING RICKSHAW 4W"},{VehicleType:"OPEN TRAILER"},{VehicleType:"OWN VECH/BYHAND/COURIER"},{VehicleType:"PICK-UP"}];let e=new sap.ui.model.json.JSONModel;e.setData(this.vehicleTypes);this.getView().byId("idVehicalType").setModel(e)},getTransporter:function(){this.aTransporterList=[{Transporter:"SRIPRIYA CARRIERS"},{Transporter:"SLS TRANSPORT"},{Transporter:"SWARAJ LOGISTICS"},{Transporter:"CITY TRANSPORT"},{Transporter:"SAIKRISHNA TRANSLINE"},{Transporter:"SANTKRUPA ROADWAYS"},{Transporter:"BHARATH SWIFT LOGISTICS"},{Transporter:"SIDHNATH"},{Transporter:"KARTIK TRANSPORT"},{Transporter:"KAILASH ROAD LINES"},{Transporter:"ANGEL TRANSPORT"},{Transporter:"BHAGWAT TRANSPORT"},{Transporter:"SANTKRUPA"},{Transporter:"BHAGWAT TRANSPORT."},{Transporter:"NIKHIL CARGO SERVICES"},{Transporter:"SIDDHANATH"},{Transporter:"SRI VENKATESHWARA TRANSPORTS"},{Transporter:"BHAGWAT TRANSPOR"},{Transporter:"MEGHA INDUSTRAL ELECTRONICS"},{Transporter:"COMPANY VEHICLE"},{Transporter:"SIDHNATH ROADLINES"},{Transporter:"KAMAL CED LLP"},{Transporter:"RAREWALA TRANSPORT"},{Transporter:"VENNILA TRANSPORT"},{Transporter:"METEORIC LOGISTICS PVT LTD"},{Transporter:"SRI CHAMUDESWARI TRANSPORT"},{Transporter:"SLV TRANSPORT"},{Transporter:"TUBE INVESTMENTS"},{Transporter:"AADHIR TRANSPORT"},{Transporter:"AYUSH ENGINEERING"},{Transporter:"BHUSAN POWER"},{Transporter:"GANESHA TRANSPORT"},{Transporter:"JAYA SHREE RAM CARRIERS"},{Transporter:"KPR TUBES"},{Transporter:"MAX TRANSPORT"},{Transporter:"METEORIC LOGISTICS P LTD"},{Transporter:"MMT SUPPLY CHAIN SYSTEMS"},{Transporter:"PARTI VEHICLE"},{Transporter:"SAI KRISNA  TRANS SOLUTIONS"},{Transporter:"SHREE KRISHNA ISPAT"},{Transporter:"SRI PRIYA"},{Transporter:"SRI PRIYA CARRIERS"},{Transporter:"SRI VENKATESHWARA TRANSPORT"},{Transporter:"SRIPRIYA CAARRIERS"},{Transporter:"JAYA SRIRAM CARRIERS"},{Transporter:"KPR TRANSPORT"},{Transporter:"NAVALADIAN TRANSPORT"},{Transporter:"VINAY ROADLINES"},{Transporter:"JAI DURGA TRANSPORT CO"},{Transporter:"KPR YTRANSPORT"},{Transporter:"GANESH WANKHEDE"},{Transporter:"PARTY VEHICLE"},{Transporter:"GANESH PRALHAD WANKHADE"},{Transporter:"MEENA KOTHAWADE"},{Transporter:"MEENA KOTHWADE"},{Transporter:"VENNILA CARRIERS"},{Transporter:"VANITA TRANSPORT"},{Transporter:"MALIKARJUN RAMLING SWAMI"},{Transporter:"WAGHMARE TRANSPORT"},{Transporter:"SHRI SAWMISAMARTH TRANSPORT"},{Transporter:"KOTHWADE"},{Transporter:"SATYAM ROAD LINES"},{Transporter:"SIDDHNATH"},{Transporter:"SIDHANATH"},{Transporter:"MOHATA DEVI TRANSPORT"},{Transporter:"VANITA TRANSPORT SERVICE"},{Transporter:"BHAGAWAT TRANSPORT"},{Transporter:"PRECIFAB PARTY VEHICLE"},{Transporter:"CONTINENTAL CARRIERS OF INDIA"},{Transporter:"CONTINENTAL CARRIERS OF INDIA(CCI T"},{Transporter:"CONTINENTAL CARRIERS OF INDIA   (C"},{Transporter:"JAI DURGA  TRANSPORT CO."},{Transporter:"JAI DURGA TRANSPORT CO."},{Transporter:"ASSOCIATED ROAD CARRIERS LTD"},{Transporter:"CCI TRANSPORT"},{Transporter:"CHAITANYA ROADLINES"},{Transporter:"DELHIVERY FRIGHT SERVICES PVT. LTD."},{Transporter:"NATIONAL ROAD CARRIERS"},{Transporter:"ROAD TRANSHIPERS OF INDIA"},{Transporter:"VISHVAJIEET EXPRESS SERVICES"}]},getBillingDocList:function(e){let t=this;t.aBillingDocList=[];t.aUniqueBillingDocList=[];let r=new sap.ui.model.Filter({path:"Plant",operator:sap.ui.model.FilterOperator.EQ,value1:e});this.ZB_OUT_GATE_Model.read("/BillingDocOut",{filters:[r],urlParameters:{...this.oParameters,$orderby:"DocumentDate desc"},success:function(e){t.aBillingDocList=e.results.sort((e,t)=>{const r=new Date(e.DocumentDate);const a=new Date(t.DocumentDate);return a-r});const r="BillingDocument";t.aUniqueBillingDocList=[...new Map(t.aBillingDocList.map(e=>[e[r],e])).values()]},error:function(e){a.error("Failed to load Billing Document List");console.log(e)}})},transporterValueHelp:function(e){try{let t=this;let r=e.getSource();let a=new sap.m.StandardListItem({active:true,title:"{Transporter}"});let n=new sap.m.SelectDialog({title:"Select Transporter",noDataText:"No Data",width:"50%",growing:true,growingThreshold:12,growingScrollToLoad:true,confirm:function(e){let t=e.getParameter("selectedContexts");if(t.length){let e=t.map(function(e){return e.getObject()});r.setValue(e[0].Transporter)}},liveChange:function(e){let t=e.getParameter("value");var r=new sap.ui.model.Filter("Transporter",sap.ui.model.FilterOperator.Contains,t);let a=e.getSource().getBinding("items");a.filter(r)}});let o=new sap.ui.model.json.JSONModel;o.setData({modelData:this.aTransporterList});n.setModel(o);n.bindAggregation("items","/modelData",a);n.open()}catch(e){that.getView().setBusy(false)}},billingNumValueHelp:function(e){try{let t=this;let r=e.getSource();let n=new sap.m.StandardListItem({active:true,title:"{BillingDocument}",description:{path:"DocumentDate",formatter:function(e){return i.formatDate(e)}}});let o=new sap.m.SelectDialog({title:"Select Billing Document No.",noDataText:"No Data",width:"50%",growing:true,growingThreshold:12,growingScrollToLoad:true,confirm:function(e){let n=e.getParameter("selectedContexts");if(n.length){let e=n.map(function(e){return e.getObject()});let o=false;t.getView().byId("idTable_OutwardItem").getModel().getData().forEach(t=>{if(t.BillingDocument===e[0].BillingDocument){o=true}});if(o){a.error(`Billing Document Number ${e[0].BillingDocument} is already selected`)}else{r.setValue(e[0].BillingDocument);r.getBindingContext().getObject().ODNNumber=e[0].ODNNumber;r.getBindingContext().getObject().IN_EDocEInvcEWbillNmbr=e[0].IN_EDocEInvcEWbillNmbr;r.getBindingContext().getObject().IN_EDocEInvcTransptDocNmbr=e[0].IN_EDocEInvcTransptDocNmbr;r.getModel().refresh()}}},liveChange:function(e){let t=e.getParameter("value");let r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("BillingDocument",sap.ui.model.FilterOperator.Contains,t)]});let a=e.getSource().getBinding("items");a.filter([r])}});let s=new sap.ui.model.json.JSONModel;s.setData({modelData:t.aUniqueBillingDocList});o.setModel(s);o.bindAggregation("items","/modelData",n);o.open()}catch(e){console.log(e)}},onAddOutwardItem:function(){let e=this.getView().byId("idTable_OutwardItem");let t=e.getModel().getData();let r={};if(t.length===0){r={Itemno:"10",BillingDocument:"",ODNNumber:"",IN_EDocEInvcEWbillNmbr:"",IN_EDocEInvcTransptDocNmbr:""}}else{let e=Math.max(...t.map(e=>parseInt(e.Itemno)));r={Itemno:(e+10).toString(),BillingDocument:"",ODNNumber:"",IN_EDocEInvcEWbillNmbr:"",IN_EDocEInvcTransptDocNmbr:""}}t.push(r);e.getModel().refresh()},onDeleteOutwardItem:function(e){let t=this.getView().byId("idTable_OutwardItem");let r=t.getModel().getData();let a=e.getSource().getBindingContext().getPath();let n=parseInt(a.substring(a.lastIndexOf("/")+1),10);r.splice(n,1);t.getModel().refresh()},onSave:function(){let e=this;let s=this.getView();let l=s.byId("idDropdownPlant").getSelectedKey(),i=s.byId("idVehicalType").getSelectedKey(),T=s.byId("id_Trasporter").getValue(),u=s.byId("idVehicalNo").getValue(),c=s.byId("idDate").getValue(),p=s.byId("idTime").getValue();if(!l||!i||T===""||u===""){n.show("Fill all mandatory fields");return}let d=o.getInstance({pattern:"yyyy-MM-dd'T'00:00:00"});let A=d.format(new Date(c)),I=p.split(":"),g=I[0].length===1?"0"+I[0]:I[0],S=`PT${g}H${I[1]}M${I[1]}S`;let m=true;var R=[];this.getView().byId("idTable_OutwardItem").getModel().getData().filter(e=>{if(e.BillingDocument===""||e.ODNNumber===""||e.IN_EDocEInvcEWbillNmbr===""||e.IN_EDocEInvcTransptDocNmbr===""){m=false}let t={Itemno:e.Itemno,Billingno:e.BillingDocument,Odnnumber:e.ODNNumber,Ewaybill:e.IN_EDocEInvcEWbillNmbr,Lrnumber:e.IN_EDocEInvcTransptDocNmbr};R.push(t)});if(!m){n.show("Fill all the table fields");return}let N={Plant:l,Vehicletype:i,Vehicleno:u,Transporter:T,Qrcode:"",SystemDate:A,SystemTime:S,to_item:R};e.getView().setBusy(true);this.ZB_OUT_GATE_Model.create("/OutwardGateHeader",N,{method:"POST",success:function(a,n){e.getView().setBusy(false);let o=n.data.GateEntryId;console.log(n);var s=new t({title:"Success",type:"Message",state:"Success",content:new sap.m.Text({text:`Gate Entry Number ${o} generated successfully`}),beginButton:new r({text:"Ok",press:function(){e.clearFieldsOnScreen();s.close()}}),afterClose:function(){s.destroy()}});s.open()},error:function(t){e.getView().setBusy(false);if(t.responseText&&(t.statusCode===400||t.statusCode==="400")){var r=JSON.parse(t.responseText);var n=r.error.message.value}else if(t.responseText&&(t.statusCode===500||t.statusCode==="500")){var o=new DOMParser;var s=o.parseFromString(t.responseText,"text/xml");var n=s.documentElement.childNodes[1].innerHTML}else{var n=t.message}var l=!!e.getView().$().closest(".sapUiSizeCompact").length;a.error(n,{styleClass:l?"sapUiSizeCompact":""})}})},clearFieldsOnScreen:function(){let e=this.getView();e.byId("idDropdownPlant").setSelectedKey();e.byId("idDropdownPlant").setValue();e.byId("idVehicalType").setSelectedKey();e.byId("idVehicalType").setValue();e.byId("id_Trasporter").setValue();e.byId("idVehicalNo").setValue();let t=o.getInstance({pattern:"MMM dd, yyyy"});let r=new Date;let a=t.format(r);this.byId("idDate").setValue(a);let n=`${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}`;this.byId("idTime").setValue(n);let s=new sap.ui.model.json.JSONModel([]);e.byId("idTable_OutwardItem").setModel(s);this.onAddOutwardItem()},onCancelGateEntry:function(){let e=this;let t=this.getView().byId("idDropdownPlant").getSelectedKey();if(!t){n.show("Select a Plant");return}if(!this.oFixedSizeDialog){let t=new sap.m.Input({maxLength:20,showValueHelp:true,valueHelpRequest:function(t){e.GateEntryNoF4Help(t)},liveChange:function(e){if(isNaN(e.getSource().getValue())){e.getSource().setValue();n.show("Enter valid number")}}});let r=new sap.m.TextArea({width:"100%",rows:3,maxLength:50});this.oFixedSizeDialog=new sap.m.Dialog({title:"Cancel Gate Entry",contentWidth:"500px",contentHeight:"270px",content:new sap.m.Panel({content:[new sap.m.VBox({items:[new sap.m.Label({text:"Gate Entry Number",required:true}),t,new sap.m.Label({text:"Remark",required:true}),r]})]}).addStyleClass("sapUiContentPadding","sapUiSmallMarginTop"),beginButton:new sap.m.Button({type:u.Emphasized,text:"Submit",press:function(){let o=t.getValue();let s=r.getValue();if(o===""||s===""){n.show("Enter the Gate Entry Number & Remark");return}let l={Status:"05",Remarks:s};e.getView().setBusy(true);this.ZB_OUT_GATE_Model.update(`/OutwardGateHeader('${o}')`,l,{success:function(t,r){e.getView().setBusy(false);a.success(`Gate Entry Number ${o} has been cancelled`)},error:function(t){e.getView().setBusy(false);if(t.responseText&&(t.statusCode===400||t.statusCode==="400")){var r=JSON.parse(t.responseText);var n=r.error.message.value}else if(t.responseText&&(t.statusCode===500||t.statusCode==="500")){var o=new DOMParser;var s=o.parseFromString(t.responseText,"text/xml");var n=s.documentElement.childNodes[1].innerHTML}else{var n=t.message}var l=!!e.getView().$().closest(".sapUiSizeCompact").length;a.error(n,{styleClass:l?"sapUiSizeCompact":""})}});t.setValue();r.setValue();e.oFixedSizeDialog.close()}.bind(this)}),endButton:new sap.m.Button({text:"Close",press:function(){t.setValue();r.setValue();this.oFixedSizeDialog.close()}.bind(this)})});this.getView().addDependent(this.oFixedSizeDialog)}this.oFixedSizeDialog.open();e.aGateEntryNum=[];let r={$top:500};let o=new sap.ui.model.Filter({path:"Plant",operator:sap.ui.model.FilterOperator.EQ,value1:t});this.ZB_OUT_GATE_Model.read("/OutwardGateHeader",{filters:[o],urlParameters:r,success:function(t){e.aGateEntryNum=t.results.sort((e,t)=>t.GateEntryId-e.GateEntryId)},error:function(e){a.error("Failed to load gate entry number list")}})},GateEntryNoF4Help:function(e){try{let t=this;let r=e.getSource();let a=new sap.m.StandardListItem({active:true,title:"{GateEntryId}"});let n=new sap.m.SelectDialog({title:"Select Gate Entry ID",noDataText:"No Data",width:"50%",growing:true,growingThreshold:12,growingScrollToLoad:true,confirm:function(e){let t=e.getParameter("selectedContexts");if(t.length){let e=t.map(function(e){return e.getObject()});r.setValue(e[0].GateEntryId)}},liveChange:function(e){let t=e.getParameter("value");let r=new sap.ui.model.Filter("GateEntryId",sap.ui.model.FilterOperator.Contains,t);let a=e.getSource().getBinding("items");a.filter(r)}});let o=new sap.ui.model.json.JSONModel;o.setData({modelData:t.aGateEntryNum});n.setModel(o);n.bindAggregation("items","/modelData",a);n.open()}catch(e){console.log(e)}}})});
//# sourceMappingURL=View1.controller.js.map